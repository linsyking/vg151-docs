<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Zombies in JI" href="../l10/lab10.html" /><link rel="prev" title="C Questions" href="../mid2/rc_part6.html" />

    <meta name="generator" content="sphinx-5.3.0, furo 2022.09.29"/>
        <title>A Toy Calculator - VG151 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=d81277517bee4d6b0349d71bb2661d4890b5617c" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">VG151  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">VG151  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../unfiled/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../l7/lab7.html">Lab 7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../l8/lab8.html">Lab 8</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mid2/rc_part3.html">Mid 2 RC (Part 3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mid2/rc_part6.html">Mid 2 RC (Part 6)</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Lab 9</a></li>
<li class="toctree-l1"><a class="reference internal" href="../l10/lab10.html">Lab 10</a></li>
<li class="toctree-l1"><a class="reference internal" href="../l10/git.html">Git Revisit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unfiled/codecheck.html">Code Check</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="a-toy-calculator">
<h1>A Toy Calculator<a class="headerlink" href="#a-toy-calculator" title="Permalink to this heading">#</a></h1>
<section id="about-project-3">
<h2>About Project 3<a class="headerlink" href="#about-project-3" title="Permalink to this heading">#</a></h2>
<p>Project 3 is a team project. You have already been divided into several pgroups. You should start p3 as soon as possible. To start your p3, here is what you should do:</p>
<ul class="simple">
<li><p>Setup Drone. Only one person in a group needs to setup Drone. The process is similar to p2. <strong>Make sure you check the “Allow Pull Requests” when creating secret.</strong></p></li>
<li><p>Connect to the non private p3 channel on MM and introduce yourself*</p></li>
<li><p>Each student carefully read p3 description and ensures they fully understand it*</p></li>
<li><p>Before starting to code each member draws hierarchy diagrams (as we saw in the lectures)</p></li>
<li><p>All team members meet (online or offline) to discuss their understanding of p3 and compare their diagrams</p></li>
<li><p>Argue on which diagram seems the most appropriate and will lead to the nicest coding experience</p></li>
<li><p>Once a best diagram is agreed upon, share the work fairly among all students</p></li>
<li><p>Students with much expertise must help the beginners</p></li>
<li><p>Beginners must ensure they understand what more advanced students are doing</p></li>
<li><p>P3 grade will be based on the final submission, a self evaluation survey, git commits, help provided to or asked by beginners</p></li>
</ul>
<p><strong>for future disucssions you can use your private channel, but we want to ensure all students are present and ready to work</strong></p>
</section>
<section id="stack-based-calculator">
<h2>Stack-based Calculator<a class="headerlink" href="#stack-based-calculator" title="Permalink to this heading">#</a></h2>
<p>Before we start doing a “real” calculator, let’s learn how to implement a calculator by using <code class="code highlight cpp docutils literal highlight-cpp"><span class="n">stack</span><span class="w"></span></code>. A stack is a data structure that allows you to push and pop elements. It is a LIFO (Last In First Out) data structure. For example, if you push 1, 2, 3, 4, 5 to the stack, you will get 5, 4, 3, 2, 1 when you pop them out.</p>
<figure class="align-default" id="id5">
<a class="reference internal image-reference" href="../_images/stack_vs_queue.jpg"><img alt="../_images/stack_vs_queue.jpg" src="../_images/stack_vs_queue.jpg" style="width: 523.0px; height: 228.0px;" /></a>
<figcaption>
<p><span class="caption-text">Stack vs Queue</span><a class="headerlink" href="#id5" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>How do we implement a stack in C++?</p>
<p>C++ has a strong library called <cite>STL</cite> (Standard Template Library). It is composed of:</p>
<ul class="simple">
<li><p>Containers</p></li>
<li><p>Iterators</p></li>
<li><p>Algorithms</p></li>
<li><p>Functions</p></li>
</ul>
<p>STL Containers provide us with several handy and efficient implementation of data structures. For example, we can use <cite>std::stack</cite> to implement a stack. Here is how we can use <cite>std::stack</cite>:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stack&gt;</span><span class="cp"></span>
</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">stack</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">s</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">top</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">s</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You need to include <code class="docutils literal notranslate"><span class="pre">&lt;stack&gt;</span></code> to use <code class="docutils literal notranslate"><span class="pre">std::stack</span></code>.</p>
</div>
<p>The output of the above program is:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="m">5</span>
<span class="m">4</span>
<span class="m">3</span>
<span class="m">2</span>
<span class="m">1</span>
</pre></div>
</div>
<p>Besides <code class="code highlight cpp docutils literal highlight-cpp"><span class="n">std</span><span class="o">::</span><span class="n">stack</span><span class="w"></span></code>, STL also provides <code class="code highlight cpp docutils literal highlight-cpp"><span class="n">std</span><span class="o">::</span><span class="n">queue</span><span class="w"></span></code>, <code class="code highlight cpp docutils literal highlight-cpp"><span class="n">std</span><span class="o">::</span><span class="n">set</span><span class="w"></span></code>, <code class="code highlight cpp docutils literal highlight-cpp"><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="w"></span></code> and <code class="code highlight cpp docutils literal highlight-cpp"><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="w"></span></code> which are commonly used. You can read more about them in the <a class="reference external" href="https://cplusplus.com/reference/stl">STL Reference</a>.</p>
<p>Now let’s implement a stack-based calculator.</p>
<p>This calculator is quite <cite>simple</cite> and <cite>limited</cite>. It only supports the following operations:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">+</span></code>: addition</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-</span></code>: subtraction</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*</span></code>: multiplication</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/</span></code>: division</p></li>
</ul>
<p>To simplify the process, the number can only be 1 digit, and no space is allowed between the number and the operator. For example, <code class="docutils literal notranslate"><span class="pre">1+2</span></code> is valid, but <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">+</span> <span class="pre">2</span></code> is not. The calculator will read the input from the standard input (i.e. keyboard) and output the result to the standard output (i.e. screen). And no parentheses are allowed.</p>
<p>Before we start writing the code, let’s first understand how the algorithm works.</p>
<section id="simplified-version-of-shunting-yard-algorithm">
<h3>Simplified version of <cite>Shunting Yard Algorithm</cite><a class="headerlink" href="#simplified-version-of-shunting-yard-algorithm" title="Permalink to this heading">#</a></h3>
<p>Before we introduce this quite compilcated algorithm, let’s first understand the concept of <cite>infix expression</cite> and <cite>postfix expression</cite>. An <cite>infix expression</cite> is an expression that contains operators and operands. For example, <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">+</span> <span class="pre">2</span></code> is an infix expression. An <cite>postfix expression</cite> is an expression that contains operators and operands, but the operators are written after the operands. For example, <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">2</span> <span class="pre">+</span></code> is a postfix expression. We also assume that the operators can only be one of <code class="docutils literal notranslate"><span class="pre">+-*/</span></code> (they are all left-associative). The following table shows the conversion between infix expression and postfix expression:</p>
<div class="table-wrapper docutils container" id="id6">
<table class="docutils align-default" id="id6">
<caption><span class="caption-text">Infix Expression vs Postfix Expression</span><a class="headerlink" href="#id6" title="Permalink to this table">#</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Infix Expression</p></th>
<th class="head"><p>Postfix Expression</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">+</span> <span class="pre">2</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">2</span> <span class="pre">+</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">+</span> <span class="pre">2</span> <span class="pre">*</span> <span class="pre">3</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">2</span> <span class="pre">3</span> <span class="pre">*</span> <span class="pre">+</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">(1</span> <span class="pre">+</span> <span class="pre">2)</span> <span class="pre">*</span> <span class="pre">3</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">2</span> <span class="pre">+</span> <span class="pre">3</span> <span class="pre">*</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">+</span> <span class="pre">2</span> <span class="pre">*</span> <span class="pre">3</span> <span class="pre">+</span> <span class="pre">4</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">2</span> <span class="pre">3</span> <span class="pre">*</span> <span class="pre">+</span> <span class="pre">4</span> <span class="pre">+</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<p>The algorithm is called <a class="reference external" href="https://en.wikipedia.org/wiki/Shunting-yard_algorithm">Shunting Yard Algorithm</a> (invented by <a class="reference external" href="https://en.wikipedia.org/wiki/Edsger_W._Dijkstra">Edsger Dijkstra</a>). It is a <cite>stack-based</cite> algorithm that converts an <cite>infix expression</cite> to a <cite>postfix expression</cite>. The algorithm is quite <cite>complicated</cite> and <cite>long</cite> (and is not quite generally and commonly used). We will only use a simplified version of it.</p>
<p>But why do wee need to do the conversion? Why is <cite>postfix expression</cite> better than <cite>infix expression</cite>? The answer is that <cite>postfix expression</cite> is easier to evaluate. For example, to evaluate <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">+</span> <span class="pre">2</span> <span class="pre">*</span> <span class="pre">3</span></code>, we can first convert it to <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">2</span> <span class="pre">3</span> <span class="pre">*</span> <span class="pre">+</span></code>. Then we can evaluate it by using a stack. (Do some demonstration here to show that it is easier to evaluate a postfix expression.)</p>
<p>The simplified version of the <cite>Shunting Yard Algorithm</cite> is as follows:</p>
<figure class="align-default" id="id7">
<a class="reference internal image-reference" href="../_images/shunting_demo.png"><img alt="../_images/shunting_demo.png" src="../_images/shunting_demo.png" style="width: 397.0px; height: 449.5px;" /></a>
<figcaption>
<p><span class="caption-text">Shunting Yard Algorithm Demo</span><a class="headerlink" href="#id7" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="n">there</span> <span class="n">are</span> <span class="n">tokens</span> <span class="n">to</span> <span class="n">be</span> <span class="n">read</span><span class="p">:</span>
    <span class="n">read</span> <span class="n">a</span> <span class="n">token</span>
    <span class="k">if</span> <span class="n">the</span> <span class="n">token</span> <span class="ow">is</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">a</span> <span class="n">number</span><span class="p">:</span>
        <span class="n">put</span> <span class="n">it</span> <span class="n">into</span> <span class="n">the</span> <span class="n">output</span> <span class="n">queue</span>
    <span class="o">-</span> <span class="n">an</span> <span class="n">operator</span> <span class="n">o1</span><span class="p">:</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">there</span> <span class="ow">is</span> <span class="n">an</span> <span class="n">operator</span> <span class="n">o2</span> <span class="n">at</span> <span class="n">the</span> <span class="n">top</span> <span class="n">of</span> <span class="n">the</span> <span class="n">operator</span> <span class="n">stack</span><span class="p">,</span> <span class="ow">and</span>
        <span class="p">(</span><span class="n">o2</span> <span class="n">has</span> <span class="n">greater</span> <span class="n">precedence</span> <span class="n">than</span> <span class="n">o1</span> <span class="ow">or</span> <span class="n">they</span> <span class="n">have</span> <span class="n">the</span> <span class="n">same</span> <span class="n">precedence</span><span class="p">)):</span>
            <span class="n">pop</span> <span class="n">o2</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">operator</span> <span class="n">stack</span> <span class="n">into</span> <span class="n">the</span> <span class="n">output</span> <span class="n">queue</span>
        <span class="n">push</span> <span class="n">o1</span> <span class="n">onto</span> <span class="n">the</span> <span class="n">operator</span> <span class="n">stack</span>

<span class="o">/*</span> <span class="n">After</span> <span class="n">the</span> <span class="k">while</span> <span class="n">loop</span><span class="p">,</span> <span class="n">pop</span> <span class="n">the</span> <span class="n">remaining</span> <span class="n">items</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">operator</span> <span class="n">stack</span> <span class="n">into</span> <span class="n">the</span> <span class="n">output</span> <span class="n">queue</span><span class="o">.</span> <span class="o">*/</span>
<span class="k">while</span> <span class="n">there</span> <span class="n">are</span> <span class="n">tokens</span> <span class="n">on</span> <span class="n">the</span> <span class="n">operator</span> <span class="n">stack</span><span class="p">:</span>
    <span class="n">pop</span> <span class="n">the</span> <span class="n">operator</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">operator</span> <span class="n">stack</span> <span class="n">onto</span> <span class="n">the</span> <span class="n">output</span> <span class="n">queue</span>
</pre></div>
</div>
<p>(Modified from <a class="reference external" href="https://en.wikipedia.org/wiki/Shunting-yard_algorithm">Wikipedia</a>)</p>
</section>
<section id="suffix-expression-evaluation">
<h3>Suffix Expression evaluation<a class="headerlink" href="#suffix-expression-evaluation" title="Permalink to this heading">#</a></h3>
<p>Now we know how to convert an infix expression to a postfix expression. But how do we evaluate a postfix expression? The answer is that we can use a stack to do it. The algorithm is as follows:</p>
<ul class="simple">
<li><p>Create a stack to store numbers.</p></li>
<li><p>Scan the output queue (which we generated from the last step) from left to right and do the following for every scanned element</p>
<ul>
<li><p>If the element is a number, push it into the stack</p></li>
<li><p>If the element is an operator, pop it from the queue. Evaluate the operator and push the result back to the stack</p></li>
</ul>
</li>
<li><p>When the expression is ended, the number in the stack is the final answer</p></li>
</ul>
<p>Several containers and functions might be useful to implement this calculator:</p>
<ul class="simple">
<li><p><code class="code highlight cpp docutils literal highlight-cpp"><span class="n">std</span><span class="o">::</span><span class="n">stack</span><span class="w"></span></code></p></li>
<li><p><code class="code highlight cpp docutils literal highlight-cpp"><span class="n">std</span><span class="o">::</span><span class="n">queue</span><span class="w"></span></code></p></li>
<li><p><code class="code highlight cpp docutils literal highlight-cpp"><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"></span></code></p></li>
<li><p><code class="code highlight cpp docutils literal highlight-cpp"><span class="n">std</span><span class="o">::</span><span class="n">getline</span><span class="w"></span></code></p></li>
<li><p><code class="code highlight cpp docutils literal highlight-cpp"><span class="n">std</span><span class="o">::</span><span class="n">isdigit</span><span class="w"></span></code></p></li>
</ul>
</section>
<section id="reference-code">
<h3>Reference Code<a class="headerlink" href="#reference-code" title="Permalink to this heading">#</a></h3>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">calculator.cpp</span><a class="headerlink" href="#id8" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;queue&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stack&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string_view&gt;</span><span class="cp"></span>

<span class="kt">bool</span><span class="w"> </span><span class="nf">is_greater</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Judge the priority of the two operators</span>
<span class="w">    </span><span class="c1">// Return true if a is greater thean b</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;*&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;/&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;+&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;-&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">bool</span><span class="w"> </span><span class="nf">is_greater_or_equal</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Judge the priority of the two operators</span>
<span class="w">    </span><span class="c1">// Return true if a is greater or equal than b</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="n">is_greater</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">));</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">move_op</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">op1</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">queue</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">stack</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ops</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// op1 is the incoming operator</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">ops</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">is_greater_or_equal</span><span class="p">(</span><span class="n">ops</span><span class="p">.</span><span class="n">top</span><span class="p">(),</span><span class="w"> </span><span class="n">op1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">output</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">ops</span><span class="p">.</span><span class="n">top</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">ops</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">get_suffix</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">queue</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">output</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">stack</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ops</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">c</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">input</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Iterate the string</span>
<span class="w">        </span><span class="c1">// std::cout &lt;&lt; c;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">isdigit</span><span class="p">(</span><span class="n">c</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">output</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">c</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ops</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">ops</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">c</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">move_op</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">ops</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="n">ops</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">c</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">ops</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">output</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">ops</span><span class="p">.</span><span class="n">top</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">ops</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">print_queue</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">queue</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Make a copy of the queue</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;The suffix expression is: &quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">front</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">q</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">float</span><span class="w"> </span><span class="nf">evaluate_suffix</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">queue</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">suffix</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">stack</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">nums</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">suffix</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">isdigit</span><span class="p">(</span><span class="n">suffix</span><span class="p">.</span><span class="n">front</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">nums</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">suffix</span><span class="p">.</span><span class="n">front</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">float</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nums</span><span class="p">.</span><span class="n">top</span><span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="n">nums</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="kt">float</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nums</span><span class="p">.</span><span class="n">top</span><span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="n">nums</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">suffix</span><span class="p">.</span><span class="n">front</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;+&#39;</span><span class="p">:</span><span class="w"></span>
<span class="w">                    </span><span class="n">nums</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;-&#39;</span><span class="p">:</span><span class="w"></span>
<span class="w">                    </span><span class="n">nums</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">a</span><span class="p">);</span><span class="w"></span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;*&#39;</span><span class="p">:</span><span class="w"></span>
<span class="w">                    </span><span class="n">nums</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;/&#39;</span><span class="p">:</span><span class="w"></span>
<span class="w">                    </span><span class="n">nums</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">a</span><span class="p">);</span><span class="w"></span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">suffix</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">nums</span><span class="p">.</span><span class="n">top</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">queue</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">output</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w">      </span><span class="n">input</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">getline</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">get_suffix</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">print_queue</span><span class="p">(</span><span class="n">output</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;The result is: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">evaluate_suffix</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="advanced-calculator">
<h2>Advanced Calculator<a class="headerlink" href="#advanced-calculator" title="Permalink to this heading">#</a></h2>
<p><cite>(Introduce some interesting and basic concepts that you may learn in future courses)</cite></p>
<p>In the previous section, we have implemented a simple calculator. But there are some problems:</p>
<ul class="simple">
<li><p>Not support negative, real numbers</p></li>
<li><p>Not support left and right parentheses</p></li>
<li><p>Not support space (fix available)</p></li>
<li><p>Hard to generalize</p></li>
</ul>
<p>Why is it hard to generalize? Because the <cite>Grunting Yard Algorithm</cite> is not a general algorithm. For example, if we want to implement a calculator that support functions like <code class="docutils literal notranslate"><span class="pre">sin</span></code>, <code class="docutils literal notranslate"><span class="pre">cos</span></code>, <code class="docutils literal notranslate"><span class="pre">tan</span></code>, <code class="docutils literal notranslate"><span class="pre">log</span></code>, <code class="docutils literal notranslate"><span class="pre">ln</span></code>, <code class="docutils literal notranslate"><span class="pre">sqrt</span></code>, etc., we can not use the <cite>Grunting Yard Algorithm</cite> directly. Moreover, compicated symbols like <code class="docutils literal notranslate"><span class="pre">^</span></code> and <code class="docutils literal notranslate"><span class="pre">!</span></code> are not supported by the <cite>Grunting Yard Algorithm</cite> either.</p>
<p>In modern programming languages, the <cite>Grunting Yard Algorithm</cite> is not used to implement a calculator. Instead, a <cite>lexer</cite> and a <cite>parser</cite> is used. The <cite>lexer</cite> is used to split the input string into tokens, and the <cite>parser</cite> is used to parse the tokens into an <cite>abstract syntax tree</cite> (AST). The AST is then evaluated to get the result.</p>
<p>There are some programs like <cite>flex</cite> and <cite>bison</cite> that can generate a <cite>lexer</cite> and a <cite>parser</cite> automatically.</p>
<section id="a-toy-calculator-generated-by-flex-and-bison">
<h3>A Toy Calculator Generated by <cite>flex</cite> and <cite>bison</cite><a class="headerlink" href="#a-toy-calculator-generated-by-flex-and-bison" title="Permalink to this heading">#</a></h3>
<p>(Source code based on <a class="reference external" href="https://github.com/azartech/Flex-Bison-Calculator.git">this Github Repo</a>)</p>
<p>Copy the following code to <code class="docutils literal notranslate"><span class="pre">calc.y</span></code>:</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">calc.y</span><a class="headerlink" href="#id9" title="Permalink to this code">#</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>%{
#include &lt;iostream&gt;
#include &lt;cmath&gt;
#include &quot;mem.h&quot;

extern std::map&lt;std::string, double&gt; variable_map;
extern unsigned int var_counter;

int yylex(void);
void yyerror(char *);

%}

%union{
    char index[100];
    double num;
}

%token&lt;num&gt; T_FLOAT T_INT
%token&lt;num&gt; OP_POW OP_DIV OP_MUL OP_ADD OP_SUB OP_EQL
%token&lt;num&gt; EOL
%token&lt;num&gt; SYM_PRNL SYM_PRNR
%token&lt;num&gt; FUNC_SIN FUNC_COS
%token&lt;num&gt; CMD_EXT
%token&lt;index&gt; T_IDEN

%type&lt;num&gt; strt
%type&lt;num&gt; stmt
%type&lt;num&gt; expr
%type&lt;num&gt; term
%type&lt;num&gt; unary
%type&lt;num&gt; pow
%type&lt;num&gt; factor

%right OP_EQL
%left OP_ADD OP_SUB
%left OP_MUL OP_DIV
%left OP_POW

%%

strt: strt stmt EOL { std::cout &lt;&lt; $2 &lt;&lt; &quot;\n&quot;; }
	| strt EOL { std::cout &lt;&lt; &quot;\n&quot;; }
	| strt CMD_EXT { std::cout &lt;&lt; &quot;&gt;&gt; Bye!\n&quot;; exit(0); }
	| {}
;


stmt: T_IDEN OP_EQL expr           { $$ = $3; set_variable($1, $3);}
    | expr                         { $$ = $1; }
;


expr: expr OP_ADD term          { $$ = $1 + $3; }
    | expr OP_SUB term         { $$ = $1 - $3; }
    | term  { $$ = $1; }
;

term: term OP_MUL unary     { $$ = $1 * $3; }
    | term OP_DIV unary       { $$ = $1 / $3; }
    | unary                     { $$ = $1; }
;

unary: OP_SUB unary            { $$ = $2 * -1; }
    | pow                       { $$ = $1; }
;

pow: factor OP_POW pow           { $$ = std::pow($1,$3); }
    | factor                    { $$ = $1; }
;

factor: T_IDEN                                      { $$ = get_variable($1); }
    | T_INT                                         { $$ = $1; }
    | T_FLOAT                                       { $$ = $1; }
    | SYM_PRNL expr SYM_PRNR                        { $$ = ($2); }
    | FUNC_SIN SYM_PRNL expr SYM_PRNR               { $$ = std::sin($3); }
    | FUNC_COS SYM_PRNL expr SYM_PRNR               { $$ = std::cos($3); }
;


%%
void yyerror(char *s)
{
	std::cout &lt;&lt; &quot;&gt;&gt; %s\n&quot;, s;
}
int main()
{
	yyparse();
	return 0;
}
</pre></div>
</div>
</div>
<p>Copy this to <code class="docutils literal notranslate"><span class="pre">calc.l</span></code>:</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">calc.l</span><a class="headerlink" href="#id10" title="Permalink to this code">#</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>%{
#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &quot;calc.tab.h&quot;
extern YYSTYPE yylval;
void yyerror(char*);
%}

%%
&quot;+&quot; {
    printf(&quot;T_ADD  &quot;);
	return OP_ADD;
}
&quot;-&quot; {
    printf(&quot;T_SUB  &quot;);
	return OP_SUB;
}
&quot;*&quot; {
    printf(&quot;T_MUL  &quot;);
	return OP_MUL;
}
&quot;/&quot; {
    printf(&quot;T_DIV  &quot;);
	return OP_DIV;
}
&quot;^&quot; {
    printf(&quot;T_POW  &quot;);
	return OP_POW;
}
&quot;=&quot; {
    printf(&quot;T_EQL  &quot;);
	return OP_EQL;
}
&quot;(&quot; {
    printf(&quot;T_PRNL  &quot;);
	return SYM_PRNL;
}
&quot;)&quot; {
    printf(&quot;T_PRNR  &quot;);
	return SYM_PRNR;
}
&quot;sin&quot;|&quot;SIN&quot; {
    printf(&quot;T_SIN  &quot;);
	return FUNC_SIN;
}
&quot;cos&quot;|&quot;COS&quot; {
    printf(&quot;T_COS  &quot;);
	return FUNC_COS;
}

[0-9]+ {
    printf(&quot;T_INT  &quot;);
	sscanf(yytext, &quot;%lf&quot;, &amp;yylval);
	return T_INT;
}
[0-9]+(\.?[0-9]*e?-?[0-9]*)?  {
	sscanf(yytext, &quot;%lf&quot;, &amp;yylval);
	printf(&quot;T_FLOAT  &quot;);
	return T_FLOAT;
}
[a-zA-Z]([a-zA-Z]|[0-9])* {
	strcpy (yylval.index, yytext);
	printf(&quot;T_IDEN  &quot;);

	return T_IDEN;
}
\n {
	return EOL;
}
[ \t]+ {}
&quot;quit&quot;|&quot;exit&quot; {
	return CMD_EXT;
}
. {
	yyerror(&quot;ERROR: Unrecognized input!&quot;);
}

%%

int yywrap()
{
	return 1;
}
</pre></div>
</div>
</div>
<p>Copy this to <code class="docutils literal notranslate"><span class="pre">mem.h</span></code>:</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">mem.h</span><a class="headerlink" href="#id11" title="Permalink to this code">#</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#ifndef _MEM_H_</span>
<span class="c1">#define _MEM_H_</span>

<span class="c1">#include &lt;iostream&gt;</span>
<span class="c1">#include &lt;map&gt;</span>
<span class="c1">#include &lt;string&gt;</span>

<span class="n">std</span><span class="p">::</span><span class="nb">map</span><span class="o">&lt;</span><span class="n">std</span><span class="p">::</span><span class="n">string</span><span class="p">,</span> <span class="n">double</span><span class="o">&gt;</span> <span class="n">variable_map</span><span class="p">;</span>

<span class="n">void</span> <span class="n">set_variable</span><span class="p">(</span><span class="n">char</span> <span class="o">*</span><span class="n">index</span><span class="p">,</span> <span class="n">double</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">add</span> <span class="n">variables</span>
    <span class="n">variable_map</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
    <span class="n">std</span><span class="p">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;var &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">index</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot; set</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">double</span> <span class="n">get_variable</span><span class="p">(</span><span class="n">char</span> <span class="o">*</span> <span class="n">index</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">variable_map</span><span class="p">[</span><span class="n">index</span><span class="p">];</span> <span class="p">}</span>

<span class="c1">#endif</span>
</pre></div>
</div>
</div>
<p>Create a file named <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> and copy the following code in it:</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">Makefile</span><a class="headerlink" href="#id12" title="Permalink to this code">#</a></div>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="nv">.PHONY</span><span class="o">=</span>all

<span class="nf">all</span><span class="o">:</span> <span class="n">calc</span> <span class="n">run</span>

<span class="nf">lex.yy.c</span><span class="o">:</span> <span class="n">calc</span>.<span class="n">l</span>
	flex calc.l

<span class="nf">calc.tab.c</span><span class="o">:</span> <span class="n">calc</span>.<span class="n">y</span>
	bison -d calc.y

<span class="nf">calc</span><span class="o">:</span> <span class="n">calc</span>.<span class="n">tab</span>.<span class="n">c</span> <span class="n">lex</span>.<span class="n">yy</span>.<span class="n">c</span>
	g++ -o calc calc.tab.c lex.yy.c -lm

<span class="nf">run</span><span class="o">:</span> <span class="n">calc</span>
	./calc
</pre></div>
</div>
</div>
<p>Make sure you have already installed <code class="docutils literal notranslate"><span class="pre">flex</span></code> and <code class="docutils literal notranslate"><span class="pre">bison</span></code>. If not, you can install them by (using Windows MYSY2):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pacman -S flex bison
</pre></div>
</div>
<p>Then, run <code class="docutils literal notranslate"><span class="pre">make</span></code> to compile the code. You will get an executable file named <code class="docutils literal notranslate"><span class="pre">calc</span></code>. Run it and test it!</p>
<p>It is a calculator that supports basic arithmetic operations, parentheses, and some functions like <code class="docutils literal notranslate"><span class="pre">sin</span></code> and <code class="docutils literal notranslate"><span class="pre">cos</span></code> (you can add more functions by your own and create your own syntax!). You can also assign a value to a variable and use it later.</p>
</section>
<section id="understanding-what-has-happened">
<h3>Understanding what has happened<a class="headerlink" href="#understanding-what-has-happened" title="Permalink to this heading">#</a></h3>
<p>Just now we wrote a <code class="docutils literal notranslate"><span class="pre">calc.l</span></code> and a <code class="docutils literal notranslate"><span class="pre">calc.y</span></code>. In fact, the <code class="docutils literal notranslate"><span class="pre">calc.l</span></code> is the “lexer description”, and the <code class="docutils literal notranslate"><span class="pre">calc.y</span></code> is the “parser description”. The lexer is used to split the input into tokens, and the parser is used to parse the tokens and generate the syntax tree. Finally, we used <code class="docutils literal notranslate"><span class="pre">bison</span></code> and <code class="docutils literal notranslate"><span class="pre">flex</span></code> to generate the lexer and parser.</p>
<section id="what-is-lexer-and-parser">
<h4>What is Lexer and Parser?<a class="headerlink" href="#what-is-lexer-and-parser" title="Permalink to this heading">#</a></h4>
<p>In computer science, <cite>lexical analysis</cite>, lexing or tokenization is the process of converting a sequence of characters (such as in a computer program or web page) into a sequence of lexical tokens (strings with an assigned and thus identified meaning). <a class="footnote-reference brackets" href="#id3" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a></p>
<figure class="align-default" id="id13">
<a class="reference internal image-reference" href="../_images/lexer-parser.png"><img alt="../_images/lexer-parser.png" src="../_images/lexer-parser.png" style="width: 660.0px; height: 120.0px;" /></a>
<figcaption>
<p><span class="caption-text"><a class="reference external" href="https://tomassetti.me/guide-parsing-algorithms-terminology/">Lexer and Parser</a></span><a class="headerlink" href="#id13" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>A lexical token or simply <cite>token</cite> is a string with an assigned and thus identified meaning. It is structured as a pair consisting of a token name and an optional token value. The token name is a category of lexical unit.</p>
<p>Consider this expression in the C programming language:</p>
<p><code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">a</span> <span class="pre">+</span> <span class="pre">b</span> <span class="pre">*</span> <span class="pre">2;</span></code></p>
<p>The lexical analysis of this expression may yield the following sequence of tokens:</p>
<p><code class="docutils literal notranslate"><span class="pre">[(identifier,</span> <span class="pre">x),</span> <span class="pre">(operator,</span> <span class="pre">=),</span> <span class="pre">(identifier,</span> <span class="pre">a),</span> <span class="pre">(operator,</span> <span class="pre">+),</span> <span class="pre">(identifier,</span> <span class="pre">b),</span> <span class="pre">(operator,</span> <span class="pre">*),</span> <span class="pre">(literal,</span> <span class="pre">2),</span> <span class="pre">(separator,</span> <span class="pre">;)]</span></code></p>
<p>We often use <cite>regular expression</cite> to describe the lexer rules. Regular expression is a sequence of characters that define a search pattern.</p>
<p>Parser is often more complicated than lexer. We have to first define the grammar of the language, and then use the grammar to generate the parser. The parser is used to parse the tokens and generate the syntax tree. Regular expressions are often not good enough to describe the language, so we often use a more powerful tool called <cite>context-free grammar</cite> to describe the language. Context-free grammar is a formal grammar which describes all possible strings in a given formal language. It is a type of formal grammar, the set of strings which can be generated by the grammar is called the <cite>language</cite> of the grammar.</p>
<p>Lexical analysis and parsing (syntax analysis) are often the first two steps of compilation.</p>
<figure class="align-default" id="id14">
<a class="reference internal image-reference" href="../_images/compile.png"><img alt="../_images/compile.png" src="../_images/compile.png" style="width: 246.4px; height: 535.2px;" /></a>
<figcaption>
<p><span class="caption-text">Compilation Diagram <a class="footnote-reference brackets" href="#id4" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a></span><a class="headerlink" href="#id14" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="regular-expression">
<h3>Regular Expression<a class="headerlink" href="#regular-expression" title="Permalink to this heading">#</a></h3>
<p>Regular expression is used almost everywhere.</p>
<p>Regular expression matcher may have some little difference in different languages (For example, the meaning of <cite>?</cite>). You can go to <a class="reference external" href="https://regex101.com/">this website</a> to test your regular expression.</p>
</section>
<section id="commonly-used-rules">
<h3>Commonly Used Rules<a class="headerlink" href="#commonly-used-rules" title="Permalink to this heading">#</a></h3>
<p>(python example)</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">^</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">+</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">?</span></code> (Two meanings: 1. match 0 or 1 times; 2. match the shortest string)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">(xx|yy)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[a-zA-Z0-9]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[^a-zA-Z0-9]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\s</span></code>: match any whitespace character</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\S</span></code>: match any non-whitespace character</p></li>
</ul>
<p>Examples:</p>
<ul>
<li><p>Match the following code:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">expression</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">any</span><span class="w"> </span><span class="n">thing</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</li>
<li><p>Match <code class="docutils literal notranslate"><span class="pre">http://www.ABC.com</span></code> and <code class="docutils literal notranslate"><span class="pre">https://www.ABC.cn</span></code> where <code class="docutils literal notranslate"><span class="pre">ABC</span></code> can be any <code class="docutils literal notranslate"><span class="pre">a-zA-Z</span></code> characters.</p></li>
</ul>
</section>
<section id="context-free-grammar">
<h3>Context-Free Grammar<a class="headerlink" href="#context-free-grammar" title="Permalink to this heading">#</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>I don’t have enough time to finish this.</p>
</div>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id3" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Lexical_analysis">Lexical Analysis</a></p>
</aside>
<aside class="footnote brackets" id="id4" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>Fig 1.5. Compilers Principles Techniques and Tools (2nd Edition), Alfred V. Aho, Monica S. Lam, Ravi Sethi, Jeffrey D. Ullman, Addison-Wesley, 2007</p>
</aside>
</aside>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../l10/lab10.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Zombies in JI</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../mid2/rc_part6.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">C Questions </div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Linsy King
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">A Toy Calculator</a><ul>
<li><a class="reference internal" href="#about-project-3">About Project 3</a></li>
<li><a class="reference internal" href="#stack-based-calculator">Stack-based Calculator</a><ul>
<li><a class="reference internal" href="#simplified-version-of-shunting-yard-algorithm">Simplified version of <cite>Shunting Yard Algorithm</cite></a></li>
<li><a class="reference internal" href="#suffix-expression-evaluation">Suffix Expression evaluation</a></li>
<li><a class="reference internal" href="#reference-code">Reference Code</a></li>
</ul>
</li>
<li><a class="reference internal" href="#advanced-calculator">Advanced Calculator</a><ul>
<li><a class="reference internal" href="#a-toy-calculator-generated-by-flex-and-bison">A Toy Calculator Generated by <cite>flex</cite> and <cite>bison</cite></a></li>
<li><a class="reference internal" href="#understanding-what-has-happened">Understanding what has happened</a><ul>
<li><a class="reference internal" href="#what-is-lexer-and-parser">What is Lexer and Parser?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#regular-expression">Regular Expression</a></li>
<li><a class="reference internal" href="#commonly-used-rules">Commonly Used Rules</a></li>
<li><a class="reference internal" href="#context-free-grammar">Context-Free Grammar</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    </body>
</html>